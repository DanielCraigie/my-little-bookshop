#!/usr/bin/env php
<?php

require implode(DIRECTORY_SEPARATOR, ['..', '.bootstrap.php']);

use Aws\DynamoDb\DynamoDbClient;
use Danielcraigie\Bookshop\AWS\dynamodb\Table;

/** @var DynamoDbClient $dynClient */
/** @var string $tableName */

try {
    $table = new Table($dynClient, $tableName);

    if ($table->exists()) {
        $response = $dynClient->deleteTable(['TableName' => $tableName]);
        echo "Deleting table \"{$response['TableDescription']['TableName']}\" with {$response['TableDescription']['ItemCount']} records\n";
    } else {
        throw new Exception('Table[' . $tableName . '] not found.');
    }
} catch (Exception $e) {
    echo "An error occurred while deleting the table: {$e->getMessage()}";
    return 1;
}
